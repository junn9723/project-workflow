# Skill: spec-validate（スペック整合性検証）

## 目的
スペックの品質・整合性・完全性を検証し、実装との乖離を検出する。

## 前提条件
- `specs/` にスペックファイルが存在
- `specs/SPEC-INDEX.md` が最新である

## 手順

### Step 1: スペック構造の検証
各スペックファイルに対して以下を確認:
1. テンプレート準拠: `templates/spec-template.md` の全セクションが存在するか
2. 必須項目の充足:
   - [ ] 目的が明記されている
   - [ ] スコープが定義されている
   - [ ] 受け入れ条件が1つ以上ある
   - [ ] テスト方針が記載されている
   - [ ] 変更履歴が記録されている

### Step 2: スペック間の整合性
1. `specs/SPEC-INDEX.md` と実ファイルの一致を確認
2. スペック間の依存関係に矛盾がないか確認
3. 同じ機能に対する重複定義がないか確認

### Step 3: スペック ↔ テストのトレーサビリティ
1. 各スペックの受け入れ条件に対応するテストが存在するか確認
2. テストファイル内のスペック参照（`@spec: specs/xxx.md`）が正しいか確認
3. 未カバーの受け入れ条件を一覧化

### Step 4: スペック ↔ 実装の乖離検出
1. スペックに記載された機能が実装されているか確認
2. 実装に存在するがスペックに記載がない機能を検出
3. 乖離がある場合、スペック更新 or 実装修正のどちらが必要か判断

### Step 5: 検証スクリプト実行
```bash
scripts/validate-spec.sh
```

## 判定基準
- **成功**: 全チェック項目がパス
- **警告**: 軽微な不備あり（テスト不足等）
- **失敗**: 構造不備 or スペック間矛盾 or 重大な乖離

## 失敗時の対応
1. 構造不備 → スペックを修正してPR作成
2. スペック間矛盾 → 関連スペックを見直してPR作成
3. トレーサビリティ不足 → テスト追加タスクを作成
4. 実装乖離 → スペック更新 or 実装修正のタスクを作成

## 出力
```
## スペック検証レポート
- 検証日時: YYYY-MM-DD HH:MM
- 検証対象: N件のスペック
- 結果: 成功 / 警告 / 失敗

### 構造検証
| スペック | テンプレート準拠 | 必須項目 | 結果 |
|----------|------------------|----------|------|

### トレーサビリティ
| スペック | 受け入れ条件数 | テストカバー数 | カバー率 |
|----------|----------------|----------------|----------|

### 要対応事項
- [優先度: 高/中/低] [概要]
```
