# Skill: test-run（テスト実行・結果分析）

## 目的
テストを実行し、結果を分析して次のアクションを判断する。

## 前提条件
- テストフレームワークがセットアップ済み
- テストファイルが `tests/` に存在
- 対応するスペックが `specs/` に存在

## 手順

### Step 1: テスト対象の特定
1. 変更されたファイルを `git diff --name-only` で特定
2. 対応するテストファイルを `tests/` から探索
3. 対応するスペックを `specs/` から確認

### Step 2: テスト実行
1. 対象のテストを実行
   ```bash
   # プロジェクトのテストコマンドを実行
   scripts/run-tests.sh [対象パス]
   ```
2. 全テストを実行（回帰テスト）
   ```bash
   scripts/run-tests.sh --all
   ```

### Step 3: 結果分析
1. **全テスト成功**: → 完了。`code-review` スキルへ進む
2. **テスト失敗あり**:
   - 失敗したテストを一覧化
   - 各失敗の原因を分類:
     - **実装バグ**: コード修正が必要 → `self-improve` スキルへ
     - **テスト不備**: テストコードの修正が必要
     - **スペック不整合**: スペック更新が必要 → スペックPR作成
     - **環境問題**: 設定・依存関係の問題

### Step 4: レポート生成
以下の情報をPRコメントまたはタスクファイルに記録:
```
## テスト結果
- 実行日時: YYYY-MM-DD HH:MM
- 総テスト数: N
- 成功: N / 失敗: N / スキップ: N
- カバレッジ: N%
- 失敗テスト詳細:
  - [テスト名]: [原因分類] - [概要]
```

## 判定基準
- **成功**: 全テスト通過 & カバレッジが閾値以上
- **失敗**: テスト失敗あり or カバレッジ不足

## 失敗時の対応
1. 実装バグ → `self-improve` スキルを起動
2. テスト不備 → テストを修正して再実行
3. スペック不整合 → スペック変更PRを先に作成
4. 環境問題 → `scripts/setup_vps.sh` を確認

## 出力
- テスト実行結果サマリー
- カバレッジレポート
- 失敗時の原因分析と推奨アクション
